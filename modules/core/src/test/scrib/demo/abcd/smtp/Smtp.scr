//http://sandbox.kidstrythisathome.com/erdos/

//$ bin/scribblec.sh modules/core/src/test/scrib/demo/abcd/smtp/Smtp.scr -ip modules/core/src/test/scrib/ -d modules/core/src/test/scrib/ -api Smtp C
//$ javadoc -cp modules/cli/target/classes/';'modules/core/target/classes';'modules/trace/target/classes';'modules/parser/target/classes';c:\Users\Raymond\.m2\repository\org\antlr\antlr-runtime\3.2\antlr-runtime-3.2.jar;'modules/validation/target/classes/';'modules/projection/target/classes/';C:\Users\Raymond\.m2\repository\org\codehaus\jackson\jackson-mapper-asl\1.9.9\jackson-mapper-asl-1.9.9.jar;C:\Users\Raymond\.m2\repository\org\codehaus\jackson\jackson-core-asl\1.9.9\jackson-core-asl-1.9.9.jar;'modules/core/src/test/scrib -subpackages demo.abcd.smtp.Smtp.Smtp -d test/doc/abcd/smtp

//$ java -cp modules/cli/target/classes/';'modules/core/target/classes';'modules/trace/target/classes';'modules/parser/target/classes';c:\Users\Raymond\.m2\repository\org\antlr\antlr-runtime\3.2\antlr-runtime-3.2.jar;'modules/validation/target/classes/';'modules/projection/target/classes/';C:\Users\Raymond\.m2\repository\org\codehaus\jackson\jackson-mapper-asl\1.9.9\jackson-mapper-asl-1.9.9.jar;C:\Users\Raymond\.m2\repository\org\codehaus\jackson\jackson-core-asl\1.9.9\jackson-core-asl-1.9.9.jar' demo.abcd.smtp.Client


module demo.abcd.smtp.Smtp;

sig <java> "demo.abcd.smtp.message.server._220"
		from "demo/abcd/smtp/message/server/_220.java" as 220;
sig <java> "demo.abcd.smtp.message.server._250"
		from "demo/abcd/smtp/message/server/_250.java" as 250;
sig <java> "demo.abcd.smtp.message.server._250d"
		from "demo/abcd/smtp/message/server/_250d.java" as 250d;

sig <java> "demo.abcd.smtp.message.client.Ehlo"
		from "demo/abcd/smtp/message/client/Ehlo.java" as Ehlo;
sig <java> "demo.abcd.smtp.message.client.StartTls"
		from "demo/abcd/smtp/message/client/StartTls.java" as StartTls;
sig <java> "demo.abcd.smtp.message.client.Quit"
		from "demo/abcd/smtp/message/client/Quit.java" as Quit;

global protocol Smtp(role C, role S)
{
	220 from S to C; //*
	do Init(C, S);
	do StartTls(C, S);
	do Init(C, S);
	Quit from C to S;
}
/*/
	choice at C
	{
		do Init(C, S);
		do StartTls(C, S);
		do Init(C, S);
		Quit from C to S;
	}
	or
	{
		Quit from C to S;
	}
}
//*/

aux global protocol Init(role C, role S)
{
	Ehlo from C to S;
	rec X
	{
		choice at S
		{
			250d from S to C;
			continue X;
		}
		or
		{
			250 from S to C;
		}
	}
	// or { Quit from C to S; }  // FIXME: apigen
}

aux global protocol StartTls(role C, role S)
{
	StartTls from C to S;
	220 from S to C;
}
