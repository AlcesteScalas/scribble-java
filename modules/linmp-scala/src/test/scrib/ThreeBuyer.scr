//$ java -cp 'modules\linmp-scala\target\classes\;modules\cli\target\classes\;modules\core\target\classes;modules\parser\target\classes;C:\Users\Raymond\.m2\repository\org\antlr\antlr-runtime\3.2\antlr-runtime-3.2.jar;lib\antlr.jar;lib\antlr-runtime.jar;lib\commons-io.jar;lib\scribble-cli.jar;lib\scribble-core.jar;lib\scribble-parser.jar.jar' main.Main modules/linmp-scala/src/test/scrib/ThreeBuyer.scr

/**
 * Taken from [MSCS16] Global Progress for Dynamically Interleaved Sessions
 */

module ThreeBuyer;


type <java> "java.lang.Integer" from "rt.jar" as Int;
type <java> "java.lang.String" from "rt.jar" as String;
type <java> "test.twobuyer.Date" from "test/twobuyer/Date.java" as Date;


// A = 2, B = 1, S = 3
global protocol TwoBuyer(role A, role B, role S)
{
	title(String) from A to S;
	quoteA(Int) from S to A;
	quoteB(Int) from S to B;
	shareA(Int) from A to B;
	do TwoBuyerChoice(A, B, S);
}

aux global protocol TwoBuyerChoice(role A, role B, role S)
{
	choice at B
	{
		okA() from B to A;
		okS() from B to S;
		addr(String) from B to S;
		deliv(Date) from S to B;
	}
	or
	{
		quitA() from B to A;
		quitS() from B to S;
	}
}


// C = 1, B = 2
//global protocol ThreeBuyer(role C, role B)
global protocol Proto(role C, role B)
{
	contrib(Int) from B to C;  // Should be the Int on line 19
	deleg(TwoBuyerChoice@B) from B to C;
	choice at C
	{
		okC() from C to B;  // Not enforced: consistency of "ok" choice here and in the delegated session
	}
	or
	{
		quitC() from C to B;
	}
}
